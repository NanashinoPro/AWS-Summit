# 生成 AI オブザーバビリティのベストプラクティス

## 日時
2025/6/26 13:50

## 発表者
津和崎 美希

アマゾン ウェブ サービス ジャパン合同会社
ストラテジックインダストリー技術本部通信第一ソリューション部ソリューションアーキテクト

## abstract
生成 AI の採用が進む中、信頼性、透明性、最適化を確保するための包括的な可観測性が重要になっています。このセッションでは、大規模言語モデル、Retrieval Augmented Generation（RAG）アーキテクチャ、その他の新しいアプローチを含む、さまざまな生成 AI パターンの可観測性の課題について学びます。Amazon CloudWatch を幅広いメトリクス、ログ、分散トレーシングと共に使用して、生成 AI ワークロードのライフサイクルの可視性を獲得する方法を発見します。さらに、生成 AI アプリケーションを構築するための強力なフレームワークである LangChain の役割と、Amazon Bedrock や Amazon SageMaker と組み合わせて開発およびデプロイメントパイプライン全体の可観測性を向上させる方法についても探ります。

## 概要メモ
- オブザーバビリティが専門の人はちらほら……
- BYTEマガジン：AIに特化した特別号から抜粋
  - RAGやエージェントを匂わせる内容が
- ハルシネーションを起こさない
  - 評価やベンチマークからモデルを選定
  - 場合によってはチューニング
- レイテンシー
  - 80年代：15秒がゴールドスタンダードだった
  - 生成AI：数秒単位になってしまった……
- 生成AIの出力の精度を高めるためのアーキテクチャ例：RAG
  - 取り込みメカニズム
  - 分割
  - ベクトル化
  - ベクトルDB
  - クエリして使う
- Guardrails：侮辱する言葉などを防ぐことができる
- レイヤー
- オブザーバビリティ
  - サービスの状態を理解すること
  - トレース
    - 生成AI：ワークフローで入出力、トークンなどの出力情報
    - オブザ：分散トレーシング、RAG全体での処理の分散度について
- CloudWatch：最近の進化がものすごい
- レイヤー1
  - コンポーネントレベルのメトリクスが無料で使える：Vended Metrics
  - ディメンション
    - モデル別のトークン数を取得するときに使う
  - 複合アラーム
    - 複数のアラームが異常な時だけアラームを出す
  - モデル呼び出しログ
    - Bedrockでは有効化の設定が必要：設定方法は簡単
  - ログパターンの分析
- chatbotアプリ
  - Python
  - Streamlit
- 特別な設定をせずともCloudWatchに自動的に送られる
- ログ
  - 入出力を見ることができる
  - パターンで分析することもできる
    - ユーザーの使用状況を可視化することができる
- トレース
  - Trace IDで追跡することができる
- OTel
  - 親SPanと子Spanを作成
- デモ
  - S3：PDFが格納
  - ナレッジベースの範囲外の内容は応答できない
  - 3秒以上かかったトレーズをクエリできる
    - BedrockとRAGの呼び出しに時間がかかっていた
  - OpenTelemetry：OpenLLMetry、OpenLIT：LLM用のトレース機能
  - でも画像
- Guardrailsのメトリクス
  - いろんなメトリクスがある
  - ディメンションで区分け可能
  - デモ
    - 不正行為に焦点を当てる
    - 税金を回避する方法を教えてと聞いてみる
      - ガードレール発動！
    - ガードレールのIDをコードに組み込んでアプリに組み込むこともできる
    - CloudWatchでも見ることができる
      - ガードレールのarn別にレイテンシが表示される
- エンドユーザーからのフィードバック
  - Telemetryデータ：ユーザーの感情ちが入っている
    - ログに入力可能
  - ログを構造化して目と陸とログを創刊させることができる
  - EMF：いろんな実装方法がある
- まとめ
  - AWSが提供するログ・メトリクスをフル活用しよう
  - トレースを活用してコンポーネント化んのやり取りを理解しよう
  - ガードレールの利用状況を理解しよう
  - エンドユーザからのフィードバックを取得しよう
  - 